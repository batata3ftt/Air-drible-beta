local player = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local replicatedStorage = game:GetService("ReplicatedStorage")
local shootRE = replicatedStorage:FindFirstChild("ShootRE")

local ativo = false
local bloqueado = false
local contadorRodando = false

local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "DribbleToggleGui"

local container = Instance.new("Frame", ScreenGui)
container.Position = UDim2.new(0.05, 0, 0.7, 0)
container.Size = UDim2.new(0, 230, 0, 50)
container.BackgroundTransparency = 1

button = Instance.new("TextButton", container)
button.Size = UDim2.new(0, 190, 0, 50)
button.Position = UDim2.new(0, 0, 0, 0)
button.Text = "Air Dribble OFF"

-- ðŸ”´ SEMPRE VERMELHO
button.TextColor3 = Color3.fromRGB(255, 50, 50)

button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
button.Font = Enum.Font.Arcade
button.TextSize = 22
button.BorderSizePixel = 0
button.AutoButtonColor = false

stroke = Instance.new("UIStroke", button)
stroke.Color = Color3.fromRGB(255, 0, 0) -- ðŸ”´ SEMPRE VERMELHO
stroke.Thickness = 3
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

local corner = Instance.new("UICorner", button)
corner.CornerRadius = UDim.new(0, 12)

local closeButton = Instance.new("TextButton", container)
closeButton.Size = UDim2.new(0, 35, 0, 50)
closeButton.Position = UDim2.new(0, 195, 0, 0)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 200, 200)
closeButton.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
closeButton.Font = Enum.Font.Arcade
closeButton.TextSize = 22
closeButton.BorderSizePixel = 0
Instance.new("UICorner", closeButton).CornerRadius = UDim.new(0, 12)

local timerLabel = Instance.new("TextLabel", ScreenGui)
timerLabel.Name = "AirDribbleTimer"
timerLabel.Size = UDim2.new(0, 220, 0, 44)
timerLabel.Position = UDim2.new(0.5, 0, 0, 12)
timerLabel.AnchorPoint = Vector2.new(0.5, 0)
timerLabel.BackgroundTransparency = 1
timerLabel.Text = ""
timerLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
timerLabel.Font = Enum.Font.Arcade
timerLabel.TextSize = 26
timerLabel.Visible = false
timerLabel.ZIndex = 50

function airDribbleDiagonalCima()
    while ativo do
        local character = player.Character
        if character and shootRE then
            local humanoidRoot = character:FindFirstChild("HumanoidRootPart")
            if humanoidRoot then
                local forward = humanoidRoot.CFrame.LookVector
                local dir = forward + Vector3.new(0, 0.9, 0)
                local pos = humanoidRoot.Position + forward * 68 + Vector3.new(0, 7, 0)

                local args = {
                    [1] = 85,
                    [2] = dir,
                    [3] = Vector3.new(0, 0.5, 0),
                    [4] = pos,
                    [5] = false
                }

                pcall(function() shootRE:FireServer(unpack(args)) end)
            end
        end
        wait(0.2)
    end
end

local DURATION_SECONDS = 7

function iniciarContagem(duration)
    if contadorRodando then return end
    contadorRodando = true
    bloqueado = true

    timerLabel.Visible = true

    local t = duration
    while t > 0 and ativo do
        timerLabel.Text = "âš ï¸ Air Dribble: " .. t .. "s âš ï¸"
        button.Text = "Air Dribble ON ("..t..")"
        button.TextSize = 18
        wait(1)
        t = t - 1
    end

    timerLabel.Visible = false
    timerLabel.Text = ""
    bloqueado = false
    contadorRodando = false

    ativo = false
    button.Text = "Air Dribble OFF"
    button.TextSize = 22
    button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)

    -- ðŸ”´ AGORA VERMELHO NO OFF
    stroke.Color = Color3.fromRGB(255, 0, 0)
end

function toggleDribble()
    if not ativo then
        ativo = true
        button.Text = "Air Dribble ON"
        button.TextSize = 18
        button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)

        -- ðŸ”´ AGORA VERMELHO NO ON
        stroke.Color = Color3.fromRGB(255, 0, 0)

        task.spawn(airDribbleDiagonalCima)
        task.spawn(function() iniciarContagem(DURATION_SECONDS) end)
    else
        ativo = false
        bloqueado = false
        contadorRodando = false

        timerLabel.Visible = false
        timerLabel.Text = ""

        button.Text = "Air Dribble OFF"
        button.TextSize = 22
        button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)

        -- ðŸ”´ TAMBÃ‰M VERMELHO AO DESLIGAR
        stroke.Color = Color3.fromRGB(255, 0, 0)
    end
end

local dragging = false
local dragStart
local startPos

local function isInDragCorner(x, y)
    local absPos = button.AbsolutePosition
    local absSize = button.AbsoluteSize
    return (x >= absPos.X + absSize.X - 35 and x <= absPos.X + absSize.X
        and y >= absPos.Y and y <= absPos.Y + 35)
end

button.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        local pos = input.Position
        if isInDragCorner(pos.X, pos.Y) then
            dragging = true
            dragStart = Vector2.new(pos.X, pos.Y)
            startPos = container.Position
        end
    end
end)

button.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and dragging then
        local pos = input.Position
        local delta = Vector2.new(pos.X, pos.Y) - dragStart
        container.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

button.MouseButton1Click:Connect(toggleDribble)

closeButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    ativo = false
    bloqueado = false
    contadorRodando = false
end)
